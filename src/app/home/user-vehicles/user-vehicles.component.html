<!-- Tailwind test -->

<div class="flex h-100">
  <div
    class="billListContainer flex-column h-100 flex-grow-1"
    [@expandShrink]="extendedView"
    [ngClass]="{ 'border-r border-gray-300': extendedView == 'expanded' }"
  >
    <div class="">
      <div class="h-32 ml-4 py-3 px-5 mt-3 custom-banner rounded-xl mr-3">
        <div class="billListContainer">
          <div class="column1">
            <div class="text-sm text-white font-thin ml-3 mt-2">
              @if (vehiclesCount) { To add another vehicle, enter VIN number. }
              @else { You don't have any vehicles yet. To add a vehicle, enter
              VIN }
            </div>
            <div class="text-2xl text-white font-normal ml-3 mt-1">
              or Add manually
            </div>
          </div>
          <div class="flex w-48">
            <button
              (click)="toggleView()"
              class="bg-white text-purple-500 text-md font-medium py-1 px-4 rounded-full mr-5 align-items-center w-full"
            >
              Add Vehicle
            </button>
          </div>
        </div>
      </div>
    </div>

    @if (showVinForm) {
    <div
      class="card custom-card-bg border-none rounded-2xl flex flex-row m-3 py-4 px-5"
      [@fadeIn]
      [@fadeOut]
    >
      <mat-form-field class="w-full bg-transparent">
        <mat-label class="text-purple-900">Enter VIN</mat-label>
        <input
          matInput
          type="text"
          maxlength="17" autofocus
          class="border-none focus:border-none focus:bg-transparent"
          (input)="checkVinLength($event)"
          (blur)="handleVinBlur()"
          id="vin"
          [(ngModel)]="vin"
        />
      </mat-form-field>
    </div>
    }

    @if (vehiclesCount) {
      <div class="my-vehicles px-3">
    
        <div class="display-6 text-purple-700" *ngIf="vehicles.length > 0">
            My Fleet
        </div>
    
        <table *ngIf="vehicles.length > 0" class="table table-striped mt-3">
            <thead>
                <tr>
                    <th class="ellipsis" scope="col">Make</th>
                    <th class="ellipsis" scope="col">Model</th>
                    <th class="ellipsis" scope="col">Year</th>
                    <th class="ellipsis" scope="col">VIN</th>
                    <th class="ellipsis" title="License Plate" scope="col">License Plate</th>
                    <th class="ellipsis" title="State Registered" scope="col">State Registered</th>
                    <th class="ellipsis" scope="col">Mileage</th>
                    <th class="ellipsis" title="Last Mileage Recorded" scope="col">Last Mileage Recorded</th>
                    <th class="ellipsis" scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let vehicle of vehicles">
                    <td class="ellipsis" title="{{vehicle.make}}">{{vehicle?.make}}</td>
                    <td class="ellipsis" title="{{vehicle?.model}}">{{vehicle?.model}}</td>
                    <td class="ellipsis" title="{{vehicle?.year}}">{{vehicle?.year}}</td>
                    <td class="ellipsis" title="{{vehicle?.VIN}}">{{vehicle?.VIN}}</td>
                    <td class="ellipsis" title="{{vehicle?.licensePlate}}">{{vehicle?.licensePlate}}</td>
                    <td class="ellipsis" title="{{vehicle?.state}}">{{vehicle?.state}}</td>
                    <td class="ellipsis" title="{{vehicle?.mileage}}">{{vehicle?.mileage}}</td>
                    <td class="ellipsis" title="{{vehicle?.mileageDate | date}}">{{vehicle?.mileageDate | date}}</td>
                    <td class="ellipsis">
                        <img src="../../../assets/images/pencil.svg" alt="Edit" class="w-5 h-5 cursor-pointer inline-flex me-3"/>
                        <img src="../../../assets/images/bin.svg" alt="Delete" class="w-5 h-5 cursor-pointer inline-flex" (click)="openDeleteDialog(vehicle)"/>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    }
  </div>


  @if(extendedView=='expanded' && vehicle.make){

  <div class="flex flex-column" [@expandShrink]=extendedView>
    <div class="flex">
      <div class="display-5 text-purple-900 mt-3 ml-3 px-3">
        {{ vehicle.year }} {{ vehicle.make }} {{ vehicle.model }}
      </div>
      <div class="flex content-end ms-auto mt-3">
        <div class="text-sm text-purple-900 font-bold cursor-pointer" (click)="closeVehicleDetails()">
          Close
        </div>
      </div>
    </div>

    <div
      class="flex flex-wrap justify-around ps-3"
      style="align-content: flex-start"
      [@fadeIn]
      [@fadeOut]
    >
      <!-- Engine Info Card -->
      <div
        class="card custom-card-sec border-none rounded-2xl m-3 py-4 px-4 flex"
      >
        <div class="flex">
          <div class="flex items-center">
            <img
              src="../../../assets/images/engine.svg"
              alt="Engine Image"
              class="w-14 h-14"
            />
          </div>
          <div class="w-3/4 flex flex-col items-center content-end ms-auto ps-4">
            <div class="w-full flex" *ngFor="let key of vehicle.engine | keyvalue">
              @if(key.value){
              <div class="text-sm text-purple-800 font-thin content-start">
                {{ key.key | titlecase }}
              </div>
              <div class="text-sm text-purple-900 font-semibold content-end ms-auto">
                {{ key.value }}
              </div>
              }
            </div>
          </div>
        </div>
      </div>

      <!-- Body Info Card -->
      <div class="card custom-card-sec border-none rounded-2xl m-3 py-4 px-4">
        <div class="flex">
          <div class="flex items-center">
            <img
              src="../../../assets/images/car-door.svg"
              alt="Body Image"
              class="w-14 h-14"
            />
          </div>
          <div class="w-3/4 flex flex-col items-center content-end ms-auto ps-4">
            <div class="w-full flex" *ngFor="let key of vehicle.body | keyvalue">
              @if(key.value){
              <div class="text-sm text-purple-800 font-thin content-start">
                {{ key.key | titlecase }}
              </div>
              <div class="text-sm text-purple-900 font-semibold content-end ms-auto">
                {{ key.value }}
              </div>
              }
            </div>
          </div>
        </div>
      </div>

      <div class="card custom-card-sec border-none rounded-2xl m-3 py-2 px-2">
        <img [src]="vehicle.image" alt="Vehicle Image" class="flex content-center flex-grow-1 rounded-xl" />
      </div>

      <!-- Add to fleet button -->
      <div class="flex flex-column w-full py-2 px-2 justify-content-center">
        <button
          class="bg-purple-500 bg-opacity-90 text-white text-md font-thin py-3 px-3 rounded-full flex justify-content-center items-center w-3/4 ms-auto me-auto hover:bg-opacity-100 hover:font-normal"
          (click)="addVehicle()"
        >
          Add to Fleet
        </button>
      </div>
    </div>
  </div>
  }
</div>
